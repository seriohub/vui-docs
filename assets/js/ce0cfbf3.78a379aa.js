"use strict";(self.webpackChunkvelero_docs=self.webpackChunkvelero_docs||[]).push([[3653],{3676:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"getting-started/installation/scenarios/core-cluster","title":"Core Cluster Installation","description":"This scenario sets up a centralized VUI instance using VUI-Core, designed to manage multiple remote clusters from a single UI.","source":"@site/docs/getting-started/installation/scenarios/core-cluster.md","sourceDirName":"getting-started/installation/scenarios","slug":"/getting-started/installation/scenarios/core-cluster","permalink":"/docs/getting-started/installation/scenarios/core-cluster","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_label":"Core","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Single Cluster","permalink":"/docs/getting-started/installation/scenarios/single-cluster"},"next":{"title":"Agent Only","permalink":"/docs/getting-started/installation/scenarios/agent-only"}}');var t=s(4848),i=s(8453);const o={sidebar_label:"Core",sidebar_position:3},l="Core Cluster Installation",a={},c=[{value:"Namespace Creation",id:"namespace-creation",level:2},{value:"Switching to the Namespace",id:"switching-to-the-namespace",level:2},{value:"Creating Core Credentials",id:"creating-core-credentials",level:2},{value:"\ud83d\udd10 Method 1: <code>docker-registry</code> type secret",id:"-method-1-docker-registry-type-secret",level:3},{value:"\ud83d\udd10 Method 2: <code>dockerconfigjson</code> secret",id:"-method-2-dockerconfigjson-secret",level:3},{value:"Managing NATS Users",id:"managing-nats-users",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Installation",id:"installation",level:2},{value:"Access",id:"access",level:2},{value:"Additional Useful Override Files",id:"additional-useful-override-files",level:2},{value:"Notes",id:"notes",level:2},{value:"LoadBalancer IP Configuration",id:"loadbalancer-ip-configuration",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"core-cluster-installation",children:"Core Cluster Installation"})}),"\n",(0,t.jsxs)(n.p,{children:["This scenario sets up a centralized VUI instance using ",(0,t.jsx)(n.strong,{children:"VUI-Core"}),", designed to manage multiple remote clusters from a single UI."]}),"\n",(0,t.jsx)(n.h2,{id:"namespace-creation",children:"Namespace Creation"}),"\n",(0,t.jsx)(n.p,{children:"Before proceeding, create the namespace for the VUI components:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl create namespace vui\n"})}),"\n",(0,t.jsx)(n.h2,{id:"switching-to-the-namespace",children:"Switching to the Namespace"}),"\n",(0,t.jsxs)(n.p,{children:["After creating the ",(0,t.jsx)(n.code,{children:"vui"})," namespace, you can set it as the default context to avoid specifying ",(0,t.jsx)(n.code,{children:"-n vui"})," in every command."]}),"\n",(0,t.jsx)(n.p,{children:"To do so, run:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl config set-context --current --namespace=vui\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\ud83d\udccc This sets ",(0,t.jsx)(n.code,{children:"velero-ui"})," as the default namespace for your current kubectl context.\nYou can switch back to another namespace later if needed."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"creating-core-credentials",children:"Creating Core Credentials"}),"\n",(0,t.jsxs)(n.p,{children:["Sponsors will have access to the ",(0,t.jsx)(n.code,{children:"vui-core"})," package hosted under the ",(0,t.jsx)(n.code,{children:"seriohub"})," organization on ",(0,t.jsx)(n.strong,{children:"hub.serio.cloud"})," (a private Docker registry)."]}),"\n",(0,t.jsxs)(n.p,{children:["To pull the image, you must first create a Kubernetes secret with valid credentials.",(0,t.jsx)(n.br,{}),"\n","There are two supported methods:"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.h3,{id:"-method-1-docker-registry-type-secret",children:["\ud83d\udd10 Method 1: ",(0,t.jsx)(n.code,{children:"docker-registry"})," type secret"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Generate a valid username and access token"}),"\n",(0,t.jsx)(n.li,{children:"Create the registry secret:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl create secret docker-registry vui-core-login-secret \\\n  --docker-server=https://hub.serio.cloud \\\n  --docker-username=<your-username> \\\n  --docker-password=<your-token> \\\n  --docker-email=<your-email>\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\ud83d\udca1 If your token contains special characters like ",(0,t.jsx)(n.code,{children:"$"}),", remember to ",(0,t.jsxs)(n.strong,{children:["escape it using ",(0,t.jsx)(n.code,{children:"\\"})]})," or quote it properly to avoid shell parsing or Helm/Kustomize interpolation issues."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.h3,{id:"-method-2-dockerconfigjson-secret",children:["\ud83d\udd10 Method 2: ",(0,t.jsx)(n.code,{children:"dockerconfigjson"})," secret"]}),"\n",(0,t.jsx)(n.p,{children:"Alternatively, you can manually create a Docker config file:"}),"\n",(0,t.jsxs)(n.p,{children:["Create a file named ",(0,t.jsx)(n.code,{children:".dockerconfigjson"})," with the following content:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'{\n  "auths": {\n    "hub.serio.cloud": {\n      "username": "<your-username>",\n      "password": "<your-token>"\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Then create the secret:"}),"\n",(0,t.jsxs)(n.p,{children:["'''\nkubectl create secret generic harbor-creds ",(0,t.jsx)(n.br,{}),"\n","--from-file=.dockerconfigjson=.dockerconfigjson ",(0,t.jsx)(n.br,{}),"\n","--type=kubernetes.io/dockerconfigjson\n'''"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\ud83d\udccc If you use a secret name ",(0,t.jsx)(n.strong,{children:"other than"})," ",(0,t.jsx)(n.code,{children:"vui-core-login-secret"}),", be sure to update the corresponding value in your Helm configuration (",(0,t.jsx)(n.code,{children:"coreService.deployment.imagePullSecrets"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"managing-nats-users",children:"Managing NATS Users"}),"\n",(0,t.jsxs)(n.p,{children:["In this initial release, ",(0,t.jsx)(n.strong,{children:"user authentication for NATS"})," is handled via static user credentials.",(0,t.jsx)(n.br,{}),"\n","These must be created manually and stored in a Kubernetes secret."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Create a temporary file called ",(0,t.jsx)(n.code,{children:"users.conf"})," with the following content:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'users = [\n  { user = "nats-Core-User", password = "nats-Core-Pwd" },\n  { user = "nats-Agent-1-User", password = "nats-Agent-1-pwd" },\n  { user = "nats-Agent-2-User", password = "nats-Agent-2-pwd" },\n  { user = "nats-Agent-3-User", password = "nats-Agent-3-pwd" },\n]\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Create the Kubernetes secret from this file:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl create secret generic vui-nats-user-auth \\\n  --from-file=users.conf=./tmp/users.conf \\\n  -n vui \\\n  --dry-run=client -o yaml | kubectl apply -f -\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\ud83d\udd04 The NATS service includes a sidecar that watches this secret and automatically reloads its configuration.",(0,t.jsx)(n.br,{}),"\n","You ",(0,t.jsx)(n.strong,{children:"do not need to restart any pods"})," when updating user credentials."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Ingress or NodePort access to expose the UI and API"}),"\n",(0,t.jsxs)(n.li,{children:["A static IP for ",(0,t.jsx)(n.code,{children:"natsService"})," (recommended for stable multi-cluster communication)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["Use the predefined override file:",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.a,{href:"https://github.com/seriohub/vui-helm/blob/main/examples/overrides/core-cluster.yaml",children:(0,t.jsx)(n.code,{children:"core-cluster.yaml"})})]}),"\n",(0,t.jsx)(n.p,{children:"Minimal required configuration:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"global:\n  veleroNamespace: <your-velero-namespace>\n  clusterName: <core-cluster-name>\n  core: true\n\napiService:\n  secret:\n    defaultAdminUsername: <admin>\n    defaultAdminPassword: <password>\n    natsUsername: <nats-Agent-1-User>\n    natsPassword: <nats-Agent-1-Pwd>\n\ncoreService:\n  secret:\n    clientKey: <client-key>\n    defaultAdminUsername: <admin>\n    defaultAdminPassword: <password>\n    natsUsername: <nats-Core-User>\n    natsPassword: <nats-Core-Pwd>\n\nexposure:\n  mode: ingress\n  ingress:\n    spec:\n      tls:\n        - hosts:\n            - vui-core.yourdomain.com\n\nnatsService:\n  loadBalancerIP: <ip>\n"})}),"\n",(0,t.jsxs)(n.admonition,{title:"Credentials",type:"tip",children:[(0,t.jsx)(n.p,{children:"Login to the UI with the credentials defined in:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"coreService.secret.defaultAdminUsername"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"coreService.secret.defaultAdminPassword"})}),"\n"]})]}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"helm repo add seriohub https://seriohub.github.io/velero-helm\nhelm repo update\n\nhelm install vui seriohub/vui \\\n  -n vui \\\n  -f core.yaml\n"})}),"\n",(0,t.jsx)(n.h2,{id:"access",children:"Access"}),"\n",(0,t.jsx)(n.p,{children:"Once deployed, the UI will be accessible at:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"https://vui-core.yourdomain.com\n"})}),"\n",(0,t.jsx)(n.p,{children:"Use the Core dashboard to manage and monitor multiple remote clusters using Agent installations."}),"\n",(0,t.jsx)(n.h2,{id:"additional-useful-override-files",children:"Additional Useful Override Files"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.a,{href:"https://github.com/seriohub/vui-helm",children:(0,t.jsx)(n.code,{children:"vui-helm"})})," repository includes other override files for alternative use cases:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/seriohub/vui-helm/blob/main/examples/overrides/core-ldap.yaml",children:(0,t.jsx)(n.code,{children:"core-ldap.yaml"})})," \u2014 Enables LDAP authentication"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["By default, NATS is configured to use the ",(0,t.jsx)(n.code,{children:"nats"})," protocol (non-TLS)."]}),"\n",(0,t.jsx)(n.li,{children:"NATS supports TLS, but enabling it depends on the network and ingress configuration."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"loadbalancer-ip-configuration",children:"LoadBalancer IP Configuration"}),"\n",(0,t.jsx)(n.p,{children:"If your environment does not allow reserving a static LoadBalancer IP ahead of time, you can retrieve it after deployment and update the chart:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Get the assigned IP:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl get svc -n vui -o jsonpath=\"{.items[?(@.spec.type=='LoadBalancer')].status.loadBalancer.ingress[0].ip}\"\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Update the deployment with the resolved IP:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"helm upgrade vui ./chart/ -f core.yaml --set natsService.loadBalancerIP=<resolved-ip>\n\nkubectl rollout restart deployment -l component=api -n vui\nkubectl rollout restart deployment -l component=core -n vui\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var r=s(6540);const t={},i=r.createContext(t);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);